<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="950" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- 定义渐变色 -->
    <linearGradient id="appGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#E8F5E8;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C8E6C9;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="osGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#66BB6A;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="amGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#FFB74D;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="nemuGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#42A5F5;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="npcGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#BA68C8;stop-opacity:1" />
    </linearGradient>
    
    <!-- 阴影效果 -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="4" dy="4" stdDeviation="4" flood-color="#000000" flood-opacity="0.3"/>
    </filter>
    
    <!-- 箭头定义 -->
    <marker id="arrowhead" markerWidth="12" markerHeight="8" 
     refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#333" />
    </marker>
  </defs>
  
  <!-- 背景 -->
  <rect width="1200" height="950" fill="#f8f9fa" stroke="none"/>
  
  <!-- 标题 -->
  <text x="600" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#2c3e50">
    一生一芯项目架构图 - 金字塔结构
  </text>

  <!-- 金字塔第一层：应用程序层 (顶层) -->
  <g id="pyramid-level-1">
    <polygon points="500,80 700,80 680,140 520,140" fill="url(#appGrad)" filter="url(#shadow)" stroke="#388E3C" stroke-width="2"/>
    <text x="600" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2E7D32">
      应用程序层
    </text>
    <text x="600" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#2E7D32">
      (用户程序、操作系统)
    </text>
  </g>
  
  <!-- 金字塔第二层：Abstract Machine (核心层) -->
  <g id="pyramid-level-2">
    <polygon points="400,140 800,140 780,240 420,240" fill="url(#amGrad)" filter="url(#shadow)" stroke="#F57C00" stroke-width="3"/>
    <text x="600" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white">
      Abstract Machine (AM)
    </text>
    <text x="600" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white">
      硬件抽象层 - 提供统一编程接口，屏蔽硬件差异
    </text>
    
    <!-- AM组件 -->
    <rect x="440" y="205" width="60" height="25" rx="3" fill="#FFB74D" stroke="#FF9800" stroke-width="1"/>
    <text x="470" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">TRM</text>
    <text x="470" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">图灵机</text>
    
    <rect x="510" y="205" width="60" height="25" rx="3" fill="#FFB74D" stroke="#FF9800" stroke-width="1"/>
    <text x="540" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">IOE</text>
    <text x="540" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">IO扩展</text>
    
    <rect x="580" y="205" width="60" height="25" rx="3" fill="#FFB74D" stroke="#FF9800" stroke-width="1"/>
    <text x="610" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">CTE</text>
    <text x="610" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">上下文切换</text>
    
    <rect x="650" y="205" width="60" height="25" rx="3" fill="#FFB74D" stroke="#FF9800" stroke-width="1"/>
    <text x="680" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">VME</text>
    <text x="680" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">虚存</text>
    
    <rect x="720" y="205" width="60" height="25" rx="3" fill="#FFB74D" stroke="#FF9800" stroke-width="1"/>
    <text x="750" y="218" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">MPE</text>
    <text x="750" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">多处理器</text>
  </g>

  <!-- 金字塔第三层：硬件实现层 (底层) -->
  <g id="pyramid-level-3">
    <!-- NEMU分支 -->
    <polygon points="200,240 600,240 650,420 150,420" fill="url(#nemuGrad)" filter="url(#shadow)" stroke="#1976D2" stroke-width="2"/>
    <text x="375" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white">
      NEMU
    </text>
    <text x="375" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white">
      软件模拟器 - 指令级模拟
    </text>
    
    <!-- NEMU基础组件 -->
    <rect x="220" y="310" width="80" height="25" rx="3" fill="#64B5F6" stroke="#2196F3" stroke-width="1"/>
    <text x="260" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">CPU模拟</text>
    
    <rect x="310" y="310" width="80" height="25" rx="3" fill="#64B5F6" stroke="#2196F3" stroke-width="1"/>
    <text x="350" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">内存管理</text>
    
    <rect x="400" y="310" width="80" height="25" rx="3" fill="#64B5F6" stroke="#2196F3" stroke-width="1"/>
    <text x="440" y="323" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">外设模拟</text>
    <text x="440" y="333" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">VGA/键盘/音频</text>
    
    <rect x="490" y="310" width="80" height="25" rx="3" fill="#64B5F6" stroke="#2196F3" stroke-width="1"/>
    <text x="530" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">简易调试器</text>
    
    <rect x="220" y="345" width="120" height="20" rx="3" fill="#42A5F5" stroke="#1976D2" stroke-width="1"/>
    <text x="280" y="358" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">DiffTest验证</text>
    
    <rect x="350" y="345" width="120" height="20" rx="3" fill="#42A5F5" stroke="#1976D2" stroke-width="1"/>
    <text x="410" y="354" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">硬件模拟子系统</text>
    <text x="410" y="364" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="white">SDL事件处理/中断模拟</text>
    
    <rect x="480" y="345" width="120" height="20" rx="3" fill="#42A5F5" stroke="#1976D2" stroke-width="1"/>
    <text x="540" y="358" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">RISC-V ISA支持</text>
    
    <!-- 详细的硬件模拟组件 -->
    <g id="detailed-hardware-simulation">
      <!-- 第一行详细外设 -->
      <rect x="200" y="370" width="70" height="18" rx="2" fill="#90CAF9" stroke="#1976D2" stroke-width="1"/>
      <text x="235" y="382" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">VGA显卡</text>
      
      <rect x="280" y="370" width="70" height="18" rx="2" fill="#90CAF9" stroke="#1976D2" stroke-width="1"/>
      <text x="315" y="382" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">I8042键盘</text>
      
      <rect x="360" y="370" width="70" height="18" rx="2" fill="#90CAF9" stroke="#1976D2" stroke-width="1"/>
      <text x="395" y="382" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">RTC定时器</text>
      
      <rect x="440" y="370" width="70" height="18" rx="2" fill="#90CAF9" stroke="#1976D2" stroke-width="1"/>
      <text x="475" y="382" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">串口UART</text>
      
      <rect x="520" y="370" width="70" height="18" rx="2" fill="#90CAF9" stroke="#1976D2" stroke-width="1"/>
      <text x="555" y="382" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">音频设备</text>
      
      <!-- 第二行详细外设 -->
      <rect x="240" y="395" width="70" height="18" rx="2" fill="#81C784" stroke="#4CAF50" stroke-width="1"/>
      <text x="275" y="407" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">磁盘存储</text>
      
      <rect x="320" y="395" width="70" height="18" rx="2" fill="#81C784" stroke="#4CAF50" stroke-width="1"/>
      <text x="355" y="407" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">SD卡模拟</text>
      
      <rect x="400" y="395" width="70" height="18" rx="2" fill="#81C784" stroke="#4CAF50" stroke-width="1"/>
      <text x="435" y="407" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">MMIO映射</text>
      
      <rect x="480" y="395" width="70" height="18" rx="2" fill="#81C784" stroke="#4CAF50" stroke-width="1"/>
      <text x="515" y="407" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">中断控制</text>
    </g>
    
    <!-- NPC分支 -->
    <polygon points="600,240 1000,240 1050,420 550,420" fill="url(#npcGrad)" filter="url(#shadow)" stroke="#7B1FA2" stroke-width="2"/>
    <text x="775" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white">
      NPC
    </text>
    <text x="775" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white">
      硬件处理器核心 - RTL实现
    </text>
    
    <!-- NPC详细组件 -->
    <rect x="620" y="310" width="80" height="25" rx="3" fill="#CE93D8" stroke="#9C27B0" stroke-width="1"/>
    <text x="660" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">取指单元</text>
    
    <rect x="710" y="310" width="80" height="25" rx="3" fill="#CE93D8" stroke="#9C27B0" stroke-width="1"/>
    <text x="750" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">译码单元</text>
    
    <rect x="800" y="310" width="80" height="25" rx="3" fill="#CE93D8" stroke="#9C27B0" stroke-width="1"/>
    <text x="840" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">执行单元</text>
    
    <rect x="890" y="310" width="80" height="25" rx="3" fill="#CE93D8" stroke="#9C27B0" stroke-width="1"/>
    <text x="930" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">写回单元</text>
    
    <rect x="620" y="345" width="100" height="20" rx="3" fill="#BA68C8" stroke="#7B1FA2" stroke-width="1"/>
    <text x="670" y="354" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">寄存器文件</text>
    <text x="670" y="364" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">16个寄存器</text>
    
    <rect x="730" y="345" width="100" height="20" rx="3" fill="#BA68C8" stroke="#7B1FA2" stroke-width="1"/>
    <text x="780" y="354" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">总线接口</text>
    <text x="780" y="364" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">AXI4总线</text>
    
    <rect x="840" y="345" width="100" height="20" rx="3" fill="#BA68C8" stroke="#7B1FA2" stroke-width="1"/>
    <text x="890" y="354" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">Verilog RTL</text>
    <text x="890" y="364" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">硬件描述语言</text>
  </g>
  
  <!-- 层间关系箭头 -->
  <!-- 应用程序 -> AM -->
  <path d="M600 140 L600 160" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="620" y="155" font-family="Arial, sans-serif" font-size="10" fill="#333">API调用</text>
  
  <!-- AM -> NEMU -->
  <path d="M500 240 L450 260" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="420" y="255" font-family="Arial, sans-serif" font-size="10" fill="#333">软件运行</text>
  
  <!-- AM -> NPC -->
  <path d="M700 240 L750 260" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="720" y="255" font-family="Arial, sans-serif" font-size="10" fill="#333">硬件执行</text>
  
  <!-- NEMU <-> NPC 双向验证 -->
  <path d="M550 310 L650 310" stroke="#E91E63" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <path d="M650 320 L550 320" stroke="#E91E63" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <text x="600" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E91E63">DiffTest</text>
  <text x="600" y="335" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E91E63">行为一致性验证</text>
  
  <!-- 核心特性说明 -->
  <g id="key-features">
    <rect x="50" y="460" width="1100" height="140" rx="10" fill="#FFFFFF" filter="url(#shadow)" stroke="#BDBDBD" stroke-width="2"/>
    <text x="600" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">
      "一生一芯"核心特性
    </text>
    
    <!-- 左侧特性 -->
    <g id="left-features">
      <circle cx="120" cy="520" r="8" fill="#4CAF50"/>
      <text x="140" y="526" font-family="Arial, sans-serif" font-size="12" fill="#424242">
        <tspan font-weight="bold">分层抽象设计：</tspan>AM提供统一接口，应用程序无需关心底层实现
      </text>
      
      <circle cx="120" cy="545" r="8" fill="#FF9800"/>
      <text x="140" y="551" font-family="Arial, sans-serif" font-size="12" fill="#424242">
        <tspan font-weight="bold">渐进式开发：</tspan>从NEMU软件模拟验证到NPC硬件实现
      </text>
      
      <circle cx="120" cy="570" r="8" fill="#2196F3"/>
      <text x="140" y="576" font-family="Arial, sans-serif" font-size="12" fill="#424242">
        <tspan font-weight="bold">完整硬件模拟：</tspan>VGA/键盘/定时器/串口/音频/存储等外设</text>
    </g>
    
    <!-- 右侧特性 -->
    <g id="right-features">
      <circle cx="620" cy="520" r="8" fill="#2196F3"/>
      <text x="640" y="526" font-family="Arial, sans-serif" font-size="12" fill="#424242">
        <tspan font-weight="bold">双重验证机制：</tspan>NEMU与NPC通过DiffTest确保行为一致
      </text>
      
      <circle cx="620" cy="545" r="8" fill="#9C27B0"/>
      <text x="640" y="551" font-family="Arial, sans-serif" font-size="12" fill="#424242">
        <tspan font-weight="bold">完整工具链：</tspan>支持从编译、调试到性能分析的全流程
      </text>
      
      <circle cx="620" cy="570" r="8" fill="#E91E63"/>
      <text x="640" y="576" font-family="Arial, sans-serif" font-size="12" fill="#424242">
        <tspan font-weight="bold">真实硬件体验：</tspan>SDL图形界面、中断处理、MMIO映射</text>
    </g>
  </g>

</svg>
